# HMCTS Dev Test Backend
This will be the backend for the brand new HMCTS case management system.
It has a Spring Boot application with a REST API for create, retrieve, update and delete operations.
We choose Eclipse Store as a repository, which offers a wide range of cost-effective and performant
options for hosting in the cloud.

Next to develop is a Lambda backend next to the Spring Boot.

We leave it up to the Stakeholders to decide what would be commercial the best technology.
The AWS Lambda technology tends to be very low-cost and low-maintenance, although
hosting a dockerised image with the Spring Boot application usually is also accepted as
a good low-cost option.

## Technology Stack
- **Java 21**
- **Spring Boot 3**
- **Spring REST API**
- **Eclipse Store** with Spring adaptor, and local path as a persistence repository as per default
- **OpenAPI** with a Spring Documentation generator for API documentation
- **Swagger** for pretty API documentation and very basic browser based application client
- **Gradle 8** for build automation
- **Jakarta Bean Validation** for request validation
- **Lombok** for reducing boilerplate
- **JUnit 5 with Mockito** for testing
- **RestAssured** for functional testing
- **GitHub** for GIT versioning and various automatic code validations like checkstyle

## Prequisites
- IDE like Eclipse or IntelliJ for coding and version management with GIT.
- Able to run `gradlew build` successfully.
- Able to run src\main\java\uk\co\frankz\hmcts\dts\Application.java.


## API Documentation
Running the Spring Boot application picks up properties in application.yaml, with which settings
it uses a persistence repository and generates documentation.

- **OpenAPI JSON**: http://localhost:4000/v3/api-docs
- **Swagger UI**: http://localhost:4000/swagger-ui.html

![Swagger](img/screenshot-swagger.png)

| object/field | Format     | Description                                                                                                                                                                                                                                  |
|----------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TaskDto        | JSON       | Structure representing a Task entity, with fields id, description, due, status, and title.                                                                                                                                                   |
| id             | String     | Unique identifier, generated by the backend repository, typically a number string.<br/> Should be omitted for creating a Task.                                                                                                               |
| status         | String     | Task status, which can be "Initial" or "Deleted" in the first version of this implementation. <br/>Can be omitted at creation and then is defaulted to Initial.                                                                              |
| due            | String | Date and Time, in a ISO-8601 extended local or offset date-time format format,<br/> extended with a time zone indication. <br/>Example "2026-01-18T18:13:52.488Z".<br/>Can be omitted at creation and then is defaulted to the current time. |
| title          | String | Required non-blank field of a Task.                                                                                                                                                                                                          |
| description    | String | Optional (can be omitted) description of a Task.                                                                                                                                                                                             |

## IDE Project structure

```
src/
├── main
│   ├── java/uk
│   │   ├──co.frankz.hmcts.dts
│   │   │   ├──dto                                        # Data Transfer Objects
│   │   │   │  ├── Mapper                                 # Convertor between dto and model
│   │   │   │  └── TaskDto                                # Task Data Transfer Object
│   │   │   ├──model                                      # Application entities
│   │   │   │  ├──exception                               # Application exceptions
│   │   │   │  │  ├── TaskException.java                  # Generic app illegal argument exception
│   │   │   │  │  ├── TaskInvalidArgumentException.java   # Specific app argument exception
│   │   │   │  │  ├── TaskNotFoundException.java          # Specific app exception for task not found
│   │   │   │  │  └── TaskStoreException.java             # Wrapping persistence exception
│   │   │   │  ├── Status.java                            # Enum for status of a Task
│   │   │   │  └── Task.java                              # Model representing entity of a Task
│   │   │   └──spring                                     # Implementation with Spring annotations
│   │   │      ├──controller                              # Spring Controllers
│   │   │      │  ├── CreateTaskController.java
│   │   │      │  ├── DeleteTaskController.java
│   │   │      │  └── ...
│   │   │      ├── Application.java                       # Runnable Spring Boot application class
│   │   │      ├── Mapper.java                            # Convertor between dto and entity and id (managed by Spring)
│   │   │      ├── TaskExceptionHandler.java              # Spring Controller Exception
│   │   │      ├──TaskService.java                        # CRUD logic for task with id (managed by spring)
│   │   │      ├──TaskStore.java                          # CRUD implementation Spring adaptor for Eclipse Store
│   │   │      ├──TaskStoreEclipseStoreConfig.java        # Configuration Spring adaptor for Eclipse Store
│   │   │      └──TaskWithId.java                         # Task class representing entity with id managed by Spring
│   │   │
│   │   └──gov/hmcts/reform/dev                           # Original HMCTS Demo application
│   └──resources
│      └──application.yaml                                # Spring Boot properties, shared with HMCTS Demo
│
├── test                                                  # Unit tests
├── integrationTest                                       # Integration tests with Health check of running app
└── functionalTest                                        # Functional tests
    ├── CrudTaskFunctionalTest.java                       # Test to Create, Retrieve, Update and Delete over REST
    └── SampleFunctionalTest.java                         # Test for original HMCTS Demo app
```

## Deliverable
The deliverable is a Spring Boot application packages in htmcts-dev-test-backend jar file,
which also contains a resource application.yaml which declares endpoint port 4000.

This is a backend with a running REST API on a port, which consumes and produces string fields or JSON.

The relies on sufficient logging in the underlying Spring and Eclipse Store frameworks,
to handle service requests. Exceptions are wrapped into customised TaskExceptions,
which menat to have more friendly information and not to reveal (for security concerns)
to much of the underlying framework.

## Creative Effort Experience
Initial created TaskTest and model class through a TDD approach, then adding Spring MVC with Eclipse Store.
Spring typically drives one to use JPA for persistence, but I choose to use Eclipse Store, which might be
more suitable for small Serverless backend services, which I think this Task backend application likely
would be.

![JPA versus Eclipse Store](img/jpa_vs_eclipsestore.webp)

That proofed to be a learning curve, especially with testing and combination with Spring Boot.
With the Spring annotations and persistence requirements for Eclipse Store framework, the TDD approach
changed to Behavioural Driven Tests and a separation of types with Spring annotations in a package.
I have added a "life cycle" (Create, Retrieve, Update, Delete) functional test, using RestAssured, which
was new to me.

Then focussed on documentation and had to make a change in the sample framework to get my Controller classes
scanned by Swagger, by setting a property in application.yaml.
I also added an Eclipse Store property that specifies the directory for the data repository.

To illustrate that Eclipse Store offers a wider range of repository types is in this
[screenshot](img/eclipsestore-targets.png) from the Eclipse Store reference manual.


